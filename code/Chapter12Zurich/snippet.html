<pre><code style="display: block; padding: 0.5em; background-color: #f4f4f4; font-size: 0.75em; color: black;"><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">001:</span><span class="comment" style="color: #777;">//Define&nbsp;the&nbsp;namespace&nbsp;for&nbsp;our&nbsp;API.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">002:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;d3Edge&nbsp;=&nbsp;{};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">003:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">004:</span><span class="comment" style="color: #777;">//Define&nbsp;our&nbsp;data&nbsp;manager&nbsp;module.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">005:</span>d3Edge.dataManager&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="func-title">module</span><span class="params">()</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">006:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;exports&nbsp;=&nbsp;{},<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">007:</span>&nbsp;&nbsp;&nbsp;&nbsp;dispatch&nbsp;=&nbsp;d3.dispatch(<span class="string" style="color: #050;">'geoReady'</span>,&nbsp;<span class="string" style="color: #050;">'dataReady'</span>,&nbsp;<span class="string" style="color: #050;">'dataLoading'</span>),<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">008:</span>&nbsp;&nbsp;&nbsp;&nbsp;data,<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">009:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Instantiate&nbsp;a&nbsp;new&nbsp;Crossfilter.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">010:</span>&nbsp;&nbsp;&nbsp;&nbsp;transitCrossfilter&nbsp;=&nbsp;crossfilter(),<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">011:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Define&nbsp;a&nbsp;location&nbsp;variable&nbsp;for&nbsp;our&nbsp;location&nbsp;dimension.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">012:</span>&nbsp;&nbsp;&nbsp;&nbsp;location;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">013:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">014:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;method&nbsp;to&nbsp;load&nbsp;the&nbsp;csv&nbsp;file,&nbsp;and&nbsp;apply&nbsp;cleaning&nbsp;function&nbsp;asynchronously.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">015:</span>&nbsp;&nbsp;exports.loadCsvData&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_file,&nbsp;_cleaningFunc)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">016:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">017:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;the&nbsp;csv&nbsp;request&nbsp;using&nbsp;d3.csv.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">018:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;loadCsv&nbsp;=&nbsp;d3.csv(_file);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">019:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">020:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//On&nbsp;the&nbsp;progress&nbsp;event,&nbsp;dispatch&nbsp;the&nbsp;custom&nbsp;dataLoading&nbsp;event.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">021:</span>&nbsp;&nbsp;&nbsp;&nbsp;loadCsv.on(<span class="string" style="color: #050;">'progress'</span>,&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>()&nbsp;{&nbsp;dispatch.dataLoading(d3.event.loaded);});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">022:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">023:</span>&nbsp;&nbsp;&nbsp;&nbsp;loadCsv.get(<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(_err,&nbsp;_response)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">024:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Apply&nbsp;the&nbsp;cleaning&nbsp;function&nbsp;supplied&nbsp;in&nbsp;the&nbsp;_cleaningFunc&nbsp;parameter.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">025:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_response.forEach(<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">026:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_cleaningFunc(d);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">027:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">028:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Assign&nbsp;the&nbsp;cleaned&nbsp;response&nbsp;to&nbsp;our&nbsp;data&nbsp;variable.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">029:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;_response;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">030:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">031:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Add&nbsp;data&nbsp;to&nbsp;our&nbsp;Crossfilter.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">032:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transitCrossfilter.add(_response);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">033:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">034:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Setup&nbsp;the&nbsp;location&nbsp;dimension.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">035:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;=&nbsp;transitCrossfilter.dimension(<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;d.LOCATION;});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">036:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">037:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Dispatch&nbsp;our&nbsp;custom&nbsp;dataReady&nbsp;event&nbsp;passing&nbsp;in&nbsp;the&nbsp;cleaned&nbsp;data.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">038:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dispatch.dataReady(_response);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">039:</span>&nbsp;&nbsp;&nbsp;&nbsp;});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">040:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">041:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;method&nbsp;to&nbsp;access&nbsp;the&nbsp;cleaned&nbsp;data.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">042:</span>&nbsp;&nbsp;exports.getCleanedData&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">()</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">043:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;data;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">044:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">045:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">046:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;method&nbsp;to&nbsp;load&nbsp;the&nbsp;geojson&nbsp;file,&nbsp;and&nbsp;execute&nbsp;a&nbsp;custom&nbsp;callback&nbsp;on&nbsp;response.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">047:</span>&nbsp;&nbsp;exports.loadGeoJson&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_file,&nbsp;_callback)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">048:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Load&nbsp;json&nbsp;file&nbsp;using&nbsp;d3.json.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">049:</span>&nbsp;&nbsp;&nbsp;&nbsp;d3.json(_file,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(_err,&nbsp;_data)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">050:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Execute&nbsp;the&nbsp;callback,&nbsp;assign&nbsp;the&nbsp;data&nbsp;to&nbsp;the&nbsp;context.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">051:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_callback(_data);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">052:</span>&nbsp;&nbsp;&nbsp;&nbsp;});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">053:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">054:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">055:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;convienence&nbsp;method&nbsp;to&nbsp;get&nbsp;the&nbsp;size&nbsp;of&nbsp;our&nbsp;Crossfilter</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">056:</span>&nbsp;&nbsp;exports.getCrossfilterSize&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">()</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">057:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;transitCrossfilter.size();<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">058:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">059:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">060:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;filterLocation&nbsp;method&nbsp;to&nbsp;filter&nbsp;stop&nbsp;data&nbsp;by&nbsp;location&nbsp;area.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">061:</span>&nbsp;&nbsp;exports.filterLocation&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(_locationArea)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">062:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Get&nbsp;the&nbsp;longitudes&nbsp;of&nbsp;our&nbsp;bounding&nbsp;box,&nbsp;and&nbsp;contruct&nbsp;an&nbsp;array&nbsp;from&nbsp;them.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">063:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;longitudes&nbsp;=&nbsp;[_locationArea[<span class="number" style="color: #800;">0</span>][<span class="number" style="color: #800;">0</span>],&nbsp;_locationArea[<span class="number" style="color: #800;">1</span>][<span class="number" style="color: #800;">0</span>]],<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">064:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Get&nbsp;the&nbsp;latitudes&nbsp;of&nbsp;our&nbsp;bounding&nbsp;box,&nbsp;and&nbsp;construct&nbsp;an&nbsp;array&nbsp;from&nbsp;them.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">065:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latitudes&nbsp;=&nbsp;[_locationArea[<span class="number" style="color: #800;">0</span>][<span class="number" style="color: #800;">1</span>],&nbsp;_locationArea[<span class="number" style="color: #800;">1</span>][<span class="number" style="color: #800;">1</span>]];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">066:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">067:</span>&nbsp;&nbsp;&nbsp;&nbsp;location.filterFunction(<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">068:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;d[<span class="number" style="color: #800;">0</span>]&nbsp;&gt;=&nbsp;longitudes[<span class="number" style="color: #800;">0</span>]&nbsp;&amp;&amp;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">069:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d[<span class="number" style="color: #800;">0</span>]&nbsp;&lt;=&nbsp;longitudes[<span class="number" style="color: #800;">1</span>]&nbsp;&amp;&amp;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">070:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d[<span class="number" style="color: #800;">1</span>]&nbsp;&gt;=&nbsp;latitudes[<span class="number" style="color: #800;">0</span>]&nbsp;&amp;&amp;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">071:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d[<span class="number" style="color: #800;">1</span>]&nbsp;&lt;=&nbsp;latitudes[<span class="number" style="color: #800;">1</span>];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">072:</span>&nbsp;&nbsp;&nbsp;&nbsp;});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">073:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Return&nbsp;all&nbsp;records&nbsp;within&nbsp;our&nbsp;boundin&nbsp;box.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">074:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;location.top(<span class="literal" style="color: #800;">Infinity</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">075:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">076:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">077:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;getDelays&nbsp;method&nbsp;to&nbsp;filter&nbsp;and&nbsp;aggreate&nbsp;the&nbsp;delay&nbsp;data&nbsp;by&nbsp;stop.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">078:</span>&nbsp;&nbsp;exports.getDelays&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(_locations)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">079:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;delayCrossfilter&nbsp;=&nbsp;crossfilter(),<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">080:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;dimension&nbsp;by&nbsp;hour&nbsp;of&nbsp;the&nbsp;scheduled&nbsp;stop&nbsp;time.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">081:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stopTime&nbsp;=&nbsp;delayCrossfilter.dimension(<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;d.SCHEDULED.getHours();});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">082:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">083:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Group&nbsp;the&nbsp;dimension&nbsp;by&nbsp;hour,&nbsp;and&nbsp;reduce&nbsp;it&nbsp;by&nbsp;increasing&nbsp;the&nbsp;count&nbsp;for&nbsp;all&nbsp;delays&nbsp;greater&nbsp;than&nbsp;1.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">084:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lateArrivalsByStopTime&nbsp;=&nbsp;stopTime.group().reduce(<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">085:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="func-title">reduceAdd</span><span class="params">(p,v)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;v.DELAY&nbsp;&gt;&nbsp;<span class="number" style="color: #800;">0</span>&nbsp;?&nbsp;p+<span class="number" style="color: #800;">1</span>&nbsp;:&nbsp;p+<span class="number" style="color: #800;">0</span>;},<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">086:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="func-title">reduceRemove</span><span class="params">(p,v)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="number" style="color: #800;">0</span>;},<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">087:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="func-title">reduceInitial</span><span class="params">(p,v)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="number" style="color: #800;">0</span>;}<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">088:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">089:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">090:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Add&nbsp;our&nbsp;filtered&nbsp;locations&nbsp;to&nbsp;the&nbsp;crossfilter.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">091:</span>&nbsp;&nbsp;&nbsp;&nbsp;delayCrossfilter.add(_locations);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">092:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">093:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Return&nbsp;an&nbsp;array&nbsp;contained&nbsp;the&nbsp;aggregated&nbsp;data,&nbsp;and&nbsp;the&nbsp;stopTime&nbsp;dimension.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">094:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;[stopTime,&nbsp;lateArrivalsByStopTime];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">095:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">096:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">097:</span>&nbsp;&nbsp;d3.rebind(exports,&nbsp;dispatch,&nbsp;<span class="string" style="color: #050;">'on'</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">098:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">099:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;exports;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">100:</span>};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">101:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">102:</span><span class="comment" style="color: #777;">//Define&nbsp;our&nbsp;map&nbsp;module.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">103:</span>d3Edge.map&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="func-title">module</span><span class="params">()</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">104:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;our&nbsp;custom&nbsp;events,&nbsp;and&nbsp;variables.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">105:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;dispatch&nbsp;=&nbsp;d3.dispatch(<span class="string" style="color: #050;">'hover'</span>,&nbsp;<span class="string" style="color: #050;">'stopsEnd'</span>,&nbsp;<span class="string" style="color: #050;">'routesEnd'</span>,&nbsp;<span class="string" style="color: #050;">'brushing'</span>),<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">106:</span>&nbsp;&nbsp;&nbsp;&nbsp;projection,&nbsp;path,&nbsp;t,&nbsp;s,&nbsp;svg,&nbsp;center,&nbsp;scale,&nbsp;size,&nbsp;brush,&nbsp;x1,&nbsp;x2,&nbsp;y1,&nbsp;y2,&nbsp;brushX,&nbsp;brushY;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">107:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">108:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;and&nbsp;exports&nbsp;function&nbsp;that&nbsp;can&nbsp;be&nbsp;invoked&nbsp;on&nbsp;a&nbsp;selection.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">109:</span>&nbsp;&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="func-title">exports</span><span class="params">(_selection)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">110:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">111:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Set&nbsp;svg&nbsp;equal&nbsp;to&nbsp;the&nbsp;selection&nbsp;that&nbsp;invokes&nbsp;this&nbsp;module.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">112:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;svg&nbsp;=&nbsp;svg&nbsp;||&nbsp;_selection;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">113:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">114:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Bind&nbsp;an&nbsp;empty&nbsp;datum&nbsp;to&nbsp;the&nbsp;selection.&nbsp;Usefull&nbsp;later&nbsp;for&nbsp;zooming.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">115:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;svg.datum([]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">116:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">117:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Set&nbsp;the&nbsp;projection&nbsp;up&nbsp;using&nbsp;our&nbsp;scale,&nbsp;center,&nbsp;and&nbsp;size&nbsp;parameters.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">118:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;projection&nbsp;=&nbsp;projection&nbsp;||&nbsp;d3.geo.mercator()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">119:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.scale(scale)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">120:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.center(center)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">121:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.translate([size[<span class="number" style="color: #800;">0</span>]/<span class="number" style="color: #800;">2</span>,&nbsp;size[<span class="number" style="color: #800;">1</span>]/<span class="number" style="color: #800;">2</span>]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">122:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">123:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Set&nbsp;the&nbsp;path&nbsp;up&nbsp;using&nbsp;our&nbsp;projection&nbsp;definied&nbsp;above.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">124:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;path&nbsp;||&nbsp;d3.geo.path()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">125:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.projection(projection);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">126:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">127:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Get&nbsp;the&nbsp;longitude&nbsp;of&nbsp;the&nbsp;top&nbsp;left&nbsp;corner&nbsp;of&nbsp;our&nbsp;map&nbsp;area.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">128:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long1&nbsp;=&nbsp;projection.invert([<span class="number" style="color: #800;">0</span>,<span class="number" style="color: #800;">0</span>])[<span class="number" style="color: #800;">0</span>];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">129:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Get&nbsp;the&nbsp;longitude&nbsp;of&nbsp;the&nbsp;top&nbsp;right&nbsp;corner&nbsp;of&nbsp;our&nbsp;map&nbsp;area.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">130:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long2&nbsp;=&nbsp;projection.invert([width,&nbsp;<span class="number" style="color: #800;">0</span>])[<span class="number" style="color: #800;">0</span>];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">131:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">132:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Get&nbsp;the&nbsp;latitude&nbsp;of&nbsp;the&nbsp;top&nbsp;left&nbsp;corner&nbsp;of&nbsp;our&nbsp;map&nbsp;area.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">133:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lat1&nbsp;=&nbsp;projection.invert([<span class="number" style="color: #800;">0</span>,<span class="number" style="color: #800;">0</span>])[<span class="number" style="color: #800;">1</span>];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">134:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Get&nbsp;the&nbsp;latitude&nbsp;of&nbsp;the&nbsp;bottom&nbsp;left&nbsp;corner&nbsp;of&nbsp;our&nbsp;map&nbsp;area.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">135:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lat2&nbsp;=&nbsp;projection.invert([width,&nbsp;height])[<span class="number" style="color: #800;">1</span>];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">136:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">137:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;linear&nbsp;scale&nbsp;generator&nbsp;for&nbsp;the&nbsp;x&nbsp;of&nbsp;our&nbsp;brush.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">138:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;brushX&nbsp;=&nbsp;d3.scale.linear()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">139:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.range([<span class="number" style="color: #800;">0</span>,&nbsp;size[<span class="number" style="color: #800;">0</span>]])<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">140:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.domain([long1,long2]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">141:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">142:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;linear&nbsp;scale&nbsp;generator&nbsp;for&nbsp;the&nbsp;y&nbsp;of&nbsp;our&nbsp;brush.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">143:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;brushY&nbsp;=&nbsp;d3.scale.linear()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">144:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.range([<span class="number" style="color: #800;">0</span>,&nbsp;size[<span class="number" style="color: #800;">1</span>]])<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">145:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.domain([lat1,&nbsp;lat2]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">146:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">147:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;our&nbsp;brush&nbsp;using&nbsp;our&nbsp;brushX&nbsp;and&nbsp;brushY&nbsp;scales.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">148:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;brush&nbsp;=&nbsp;d3.svg.brush()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">149:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.x(brushX)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">150:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.y(brushY)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">151:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.on(<span class="string" style="color: #050;">'brush'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">()</span>&nbsp;{</span>dispatch.brushing(brush);});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">152:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">153:</span>&nbsp;&nbsp;}<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">154:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">155:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;center&nbsp;method&nbsp;to&nbsp;serve&nbsp;as&nbsp;both&nbsp;a&nbsp;getter,&nbsp;and&nbsp;a&nbsp;setter.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">156:</span>&nbsp;&nbsp;exports.center&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_coords)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">157:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">if</span>&nbsp;(!arguments.length)&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;center;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">158:</span>&nbsp;&nbsp;&nbsp;&nbsp;center&nbsp;=&nbsp;_coords;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">159:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">this</span>;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">160:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">161:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">162:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;scale&nbsp;method&nbsp;to&nbsp;serve&nbsp;as&nbsp;both&nbsp;a&nbsp;getter,&nbsp;and&nbsp;a&nbsp;setter.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">163:</span>&nbsp;&nbsp;exports.scale&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_scale)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">164:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">if</span>&nbsp;(!arguments.length)&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;scale;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">165:</span>&nbsp;&nbsp;&nbsp;&nbsp;scale&nbsp;=&nbsp;_scale;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">166:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">this</span>;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">167:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">168:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">169:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;size&nbsp;method&nbsp;to&nbsp;serve&nbsp;as&nbsp;both&nbsp;a&nbsp;getter&nbsp;and&nbsp;setter.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">170:</span>&nbsp;&nbsp;exports.size&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_size)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">171:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">if</span>&nbsp;(!arguments.length)&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;size;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">172:</span>&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;_size;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">173:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">this</span>;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">174:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">175:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">176:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;drawRoutes&nbsp;method&nbsp;that&nbsp;can&nbsp;be&nbsp;invoked&nbsp;to&nbsp;create&nbsp;routes&nbsp;for&nbsp;each&nbsp;city.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">177:</span>&nbsp;&nbsp;exports.drawRoutes&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_data)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">178:</span>&nbsp;&nbsp;&nbsp;&nbsp;svg.append(<span class="string" style="color: #050;">'path'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">179:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'class'</span>,&nbsp;<span class="string" style="color: #050;">'route'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">180:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.datum(topojson.object(_data,&nbsp;_data.objects.routes))<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">181:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'d'</span>,&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(d,&nbsp;i)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">182:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;path(d);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">183:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">184:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">185:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Dispatch&nbsp;our&nbsp;routesEnd&nbsp;event&nbsp;so&nbsp;we&nbsp;know&nbsp;with&nbsp;the&nbsp;routes&nbsp;visualization&nbsp;is&nbsp;complete.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">186:</span>&nbsp;&nbsp;&nbsp;&nbsp;dispatch.routesEnd();<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">187:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">188:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">189:</span>&nbsp;&nbsp;exports.drawStops&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_data)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">190:</span>&nbsp;&nbsp;&nbsp;&nbsp;svg.selectAll(<span class="string" style="color: #050;">'.stop'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">191:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.data(&nbsp;_data.features)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">192:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.enter().append(<span class="string" style="color: #050;">'circle'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">193:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'cx'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;projection(d.geometry.coordinates)[<span class="number" style="color: #800;">0</span>];})<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">194:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'cy'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;projection(d.geometry.coordinates)[<span class="number" style="color: #800;">1</span>];})<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">195:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'r'</span>,&nbsp;<span class="number" style="color: #800;">2</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">196:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'class'</span>,&nbsp;<span class="string" style="color: #050;">'stop'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">197:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.on(<span class="string" style="color: #050;">'mouseover'</span>,&nbsp;dispatch.hover);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">198:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">199:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">200:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;our&nbsp;addBrush&nbsp;method.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">201:</span>&nbsp;&nbsp;exports.addBrush&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">()</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">202:</span>&nbsp;&nbsp;&nbsp;&nbsp;svg.append(<span class="string" style="color: #050;">'g'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">203:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'class'</span>,&nbsp;<span class="string" style="color: #050;">'brush'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">204:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.call(brush)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">205:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.selectAll(<span class="string" style="color: #050;">'rect'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">206:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'width'</span>,&nbsp;width);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">207:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">208:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">this</span>;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">209:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">210:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">211:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Dispatch&nbsp;our&nbsp;stopsEnd&nbsp;event&nbsp;so&nbsp;we&nbsp;know&nbsp;with&nbsp;the&nbsp;stops&nbsp;visualization&nbsp;is&nbsp;complete.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">212:</span>&nbsp;&nbsp;dispatch.stopsEnd();<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">213:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">214:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Bind&nbsp;our&nbsp;custom&nbsp;events&nbsp;to&nbsp;the&nbsp;'on'&nbsp;method&nbsp;of&nbsp;our&nbsp;function.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">215:</span>&nbsp;&nbsp;d3.rebind(exports,&nbsp;dispatch,&nbsp;<span class="string" style="color: #050;">'on'</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">216:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">217:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;exports;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">218:</span>};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">219:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">220:</span>d3Edge.radialHistogram&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="func-title">module</span>&nbsp;<span class="params">()</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">221:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">222:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;slices&nbsp;=&nbsp;<span class="number" style="color: #800;">24</span>,&nbsp;<span class="comment" style="color: #777;">//24&nbsp;hours&nbsp;in&nbsp;a&nbsp;day.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">223:</span>&nbsp;&nbsp;&nbsp;&nbsp;innerRadius&nbsp;=&nbsp;<span class="number" style="color: #800;">100</span>,&nbsp;<span class="comment" style="color: #777;">//Default&nbsp;inner&nbsp;radius</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">224:</span>&nbsp;&nbsp;&nbsp;&nbsp;outerRadius&nbsp;=&nbsp;<span class="number" style="color: #800;">300</span>,&nbsp;<span class="comment" style="color: #777;">//Default&nbsp;outer&nbsp;radius</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">225:</span>&nbsp;&nbsp;&nbsp;&nbsp;innerScale&nbsp;=&nbsp;d3.scale.linear(),&nbsp;<span class="comment" style="color: #777;">//Define&nbsp;a&nbsp;scale&nbsp;for&nbsp;sizes&nbsp;segments&nbsp;based&nbsp;on&nbsp;value.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">226:</span>&nbsp;&nbsp;&nbsp;&nbsp;group,&nbsp;<span class="comment" style="color: #777;">//Our&nbsp;empty&nbsp;group&nbsp;variable</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">227:</span>&nbsp;&nbsp;&nbsp;&nbsp;dimension,&nbsp;<span class="comment" style="color: #777;">//Our&nbsp;empty&nbsp;dimension&nbsp;variable.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">228:</span>&nbsp;&nbsp;&nbsp;&nbsp;offset&nbsp;=&nbsp;<span class="number" style="color: #800;">50</span>,&nbsp;<span class="comment" style="color: #777;">//Label&nbsp;offset&nbsp;value.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">229:</span>&nbsp;&nbsp;&nbsp;&nbsp;lowerColor,&nbsp;<span class="comment" style="color: #777;">//The&nbsp;color&nbsp;used&nbsp;for&nbsp;the&nbsp;minimum&nbsp;of&nbsp;our&nbsp;range</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">230:</span>&nbsp;&nbsp;&nbsp;&nbsp;upperColor,&nbsp;<span class="comment" style="color: #777;">//The&nbsp;color&nbsp;used&nbsp;for&nbsp;the&nbsp;maximum&nbsp;of&nbsp;our&nbsp;range</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">231:</span>&nbsp;&nbsp;&nbsp;&nbsp;innerRange,&nbsp;<span class="comment" style="color: #777;">//The&nbsp;lower&nbsp;bound&nbsp;for&nbsp;radius&nbsp;value</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">232:</span>&nbsp;&nbsp;&nbsp;&nbsp;outerRange,&nbsp;<span class="comment" style="color: #777;">//The&nbsp;upper&nbsp;bound&nbsp;for&nbsp;radius&nbsp;value</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">233:</span>&nbsp;&nbsp;&nbsp;&nbsp;color&nbsp;=&nbsp;d3.scale.linear();&nbsp;<span class="comment" style="color: #777;">//Linear&nbsp;color&nbsp;scale&nbsp;used&nbsp;for&nbsp;the&nbsp;segments.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">234:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">235:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//The&nbsp;chart&nbsp;function&nbsp;our&nbsp;module&nbsp;will&nbsp;return&nbsp;with&nbsp;the&nbsp;selection&nbsp;that&nbsp;called&nbsp;it,</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">236:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//&nbsp;as&nbsp;the&nbsp;only&nbsp;argument.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">237:</span>&nbsp;&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="func-title">chart</span>&nbsp;<span class="params">(_selection)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">238:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">239:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//If&nbsp;the&nbsp;innerRange&nbsp;is&nbsp;not&nbsp;defined,&nbsp;it&nbsp;equals&nbsp;the&nbsp;innerRadius.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">240:</span>&nbsp;&nbsp;&nbsp;&nbsp;innerRange&nbsp;=&nbsp;innerRange&nbsp;&nbsp;?&nbsp;innerRange&nbsp;:&nbsp;&nbsp;innerRadius;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">241:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//If&nbsp;the&nbsp;outerRange&nbsp;is&nbsp;not&nbsp;defined,&nbsp;it&nbsp;equals&nbsp;the&nbsp;outerRadius.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">242:</span>&nbsp;&nbsp;&nbsp;&nbsp;outerRange&nbsp;=&nbsp;outerRange&nbsp;?&nbsp;outerRange&nbsp;:&nbsp;outerRadius;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">243:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">244:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Our&nbsp;d3&nbsp;arc&nbsp;generator&nbsp;for&nbsp;the&nbsp;segments.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">245:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;arc&nbsp;=&nbsp;d3.svg.arc()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">246:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.innerRadius(<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d,&nbsp;i)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;innerScale(d);})<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">247:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.outerRadius(<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d,&nbsp;i)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;outerRadius;})<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">248:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.startAngle(<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d,&nbsp;i)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="number" style="color: #800;">2</span>&nbsp;*&nbsp;Math.PI&nbsp;*&nbsp;(i/slices);})<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">249:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.endAngle(<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d,&nbsp;i)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="number" style="color: #800;">2</span>&nbsp;*&nbsp;Math.PI&nbsp;*&nbsp;((i+<span class="number" style="color: #800;">1</span>)/slices);});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">250:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">251:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Our&nbsp;d3&nbsp;arc&nbsp;generator&nbsp;for&nbsp;the&nbsp;labels.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">252:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;label&nbsp;=&nbsp;d3.svg.arc()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">253:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.innerRadius(outerRadius&nbsp;+&nbsp;offset)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">254:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.outerRadius(outerRadius&nbsp;+&nbsp;offset)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">255:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.startAngle(<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d,&nbsp;i)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="number" style="color: #800;">2</span>&nbsp;*&nbsp;Math.PI&nbsp;*&nbsp;(i/slices);})<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">256:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.endAngle(<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d,&nbsp;i)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="number" style="color: #800;">2</span>&nbsp;*&nbsp;Math.PI&nbsp;*&nbsp;((i+<span class="number" style="color: #800;">1</span>)/slices);});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">257:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">258:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">259:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//The&nbsp;total&nbsp;number&nbsp;of&nbsp;records&nbsp;for&nbsp;the&nbsp;city</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">260:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;totalRecords&nbsp;=&nbsp;dimension.group().all(),<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">261:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//The&nbsp;total&nbsp;number&nbsp;of&nbsp;delays&nbsp;for&nbsp;they&nbsp;city.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">262:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;totalDelays&nbsp;=&nbsp;group.all();<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">263:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">264:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Obtain&nbsp;the&nbsp;min&nbsp;and&nbsp;max&nbsp;for&nbsp;both&nbsp;totalRecords&nbsp;and&nbsp;totalDelays.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">265:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;records,&nbsp;set&nbsp;to&nbsp;zero.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">266:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;mintotalRecords&nbsp;=&nbsp;totalRecords.length&nbsp;?&nbsp;+totalRecords[<span class="number" style="color: #800;">0</span>].key&nbsp;:&nbsp;<span class="number" style="color: #800;">0</span>,<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">267:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxtotalRecords&nbsp;=&nbsp;totalRecords.length&nbsp;?&nbsp;+totalRecords[totalRecords.length-<span class="number" style="color: #800;">1</span>].key&nbsp;:&nbsp;<span class="number" style="color: #800;">0</span>,<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">268:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mintotalDelays&nbsp;=&nbsp;totalDelays.length&nbsp;?&nbsp;+totalDelays[<span class="number" style="color: #800;">0</span>].key&nbsp;:&nbsp;<span class="number" style="color: #800;">0</span>,<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">269:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxtotalDelays&nbsp;=&nbsp;totalDelays.length&nbsp;?&nbsp;+totalDelays[totalDelays.length-<span class="number" style="color: #800;">1</span>].key&nbsp;:&nbsp;<span class="number" style="color: #800;">0</span>;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">270:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">271:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//We&nbsp;must&nbsp;always&nbsp;have&nbsp;an&nbsp;array&nbsp;of&nbsp;length&nbsp;24.&nbsp;Inspect&nbsp;the&nbsp;totalRecords&nbsp;array,</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">272:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//&nbsp;and&nbsp;totalDelays&nbsp;array&nbsp;and&nbsp;splice&nbsp;to&nbsp;the&nbsp;beginning&nbsp;and&nbsp;end&nbsp;as&nbsp;required.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">273:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">for</span>&nbsp;(i=<span class="number" style="color: #800;">0</span>;&nbsp;i&lt;mintotalRecords;&nbsp;i++)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">274:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;totalRecords.splice(i,&nbsp;<span class="number" style="color: #800;">0</span>,&nbsp;{key:i,&nbsp;value:<span class="number" style="color: #800;">0</span>});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">275:</span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">276:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">277:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">for</span>(i=maxtotalRecords;&nbsp;i&lt;<span class="number" style="color: #800;">24</span>;&nbsp;i++){<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">278:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;totalRecords.splice(i,&nbsp;<span class="number" style="color: #800;">0</span>,&nbsp;{key:i,&nbsp;value:<span class="number" style="color: #800;">0</span>});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">279:</span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">280:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">281:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">for</span>&nbsp;(i=<span class="number" style="color: #800;">0</span>;&nbsp;i&lt;mintotalDelays;&nbsp;i++)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">282:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;totalDelays.splice(i,&nbsp;<span class="number" style="color: #800;">0</span>,&nbsp;{key:i,&nbsp;value:<span class="number" style="color: #800;">0</span>});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">283:</span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">284:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">285:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">for</span>(i=maxtotalDelays;&nbsp;i&lt;<span class="number" style="color: #800;">24</span>;&nbsp;i++){<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">286:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;totalDelays.splice(i,&nbsp;<span class="number" style="color: #800;">0</span>,&nbsp;{key:i,&nbsp;value:<span class="number" style="color: #800;">0</span>});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">287:</span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">288:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">289:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Get&nbsp;the&nbsp;min&nbsp;and&nbsp;max&nbsp;values&nbsp;for&nbsp;both&nbsp;totalRecords,&nbsp;and&nbsp;totalDelays.&nbsp;We</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">290:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//&nbsp;will&nbsp;use&nbsp;this&nbsp;for&nbsp;our&nbsp;scales.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">291:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;totalRecordsMax&nbsp;=&nbsp;d3.max(totalRecords,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;d.value;}),<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">292:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;totalRecordsMin&nbsp;=&nbsp;d3.min(totalRecords,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;d.value;});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">293:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">294:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Set&nbsp;the&nbsp;range&nbsp;and&nbsp;domain&nbsp;for&nbsp;our&nbsp;innerScale&nbsp;using&nbsp;the&nbsp;min&nbsp;and&nbsp;max&nbsp;from&nbsp;the&nbsp;totalRecords.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">295:</span>&nbsp;&nbsp;&nbsp;&nbsp;innerScale.range([outerRange,&nbsp;innerRange]).domain([totalRecordsMin,&nbsp;totalRecordsMax]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">296:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">297:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Set&nbsp;the&nbsp;color&nbsp;range&nbsp;similarly</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">298:</span>&nbsp;&nbsp;&nbsp;&nbsp;color.range([lowerColor,&nbsp;upperColor]).domain([totalRecordsMin,&nbsp;totalRecordsMax]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">299:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">300:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Update&nbsp;our&nbsp;segments&nbsp;using&nbsp;the&nbsp;current&nbsp;data.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">301:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;arcs&nbsp;=&nbsp;_selection.selectAll(<span class="string" style="color: #050;">'path'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">302:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.data(totalDelays)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">303:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'d'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d,i)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;arc(d.value,i);})<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">304:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'fill'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;color(d.value);})<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">305:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'stroke'</span>,&nbsp;<span class="string" style="color: #050;">'black'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">306:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'class'</span>,&nbsp;<span class="string" style="color: #050;">'slice'</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">307:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">308:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Add&nbsp;any&nbsp;new&nbsp;segments&nbsp;using&nbsp;the&nbsp;current&nbsp;data.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">309:</span>&nbsp;&nbsp;&nbsp;&nbsp;arcs.enter().append(<span class="string" style="color: #050;">'path'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">310:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'d'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d,i)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;arc(d.value,i);})<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">311:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'fill'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;color(d.value);})<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">312:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'class'</span>,&nbsp;<span class="string" style="color: #050;">'slice'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">313:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'stroke'</span>,&nbsp;<span class="string" style="color: #050;">'black'</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">314:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">315:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Remove&nbsp;and&nbsp;extra&nbsp;segments.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">316:</span>&nbsp;&nbsp;&nbsp;&nbsp;arcs.exit().remove();<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">317:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">318:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Attach&nbsp;our&nbsp;mouseover&nbsp;event.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">319:</span>&nbsp;&nbsp;&nbsp;&nbsp;arcs.on(<span class="string" style="color: #050;">'mouseover'</span>,&nbsp;mouseover);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">320:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">321:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Add&nbsp;our&nbsp;labels.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">322:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;labels&nbsp;=&nbsp;_selection.selectAll(<span class="string" style="color: #050;">'text'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">323:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.data(totalDelays).enter()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">324:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.append(<span class="string" style="color: #050;">"text"</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">325:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">"transform"</span>,&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(d,i)&nbsp;{&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="string" style="color: #050;">"translate("</span>&nbsp;+&nbsp;label.centroid(d,i)&nbsp;+&nbsp;<span class="string" style="color: #050;">")"</span>;&nbsp;})<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">326:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">"dy"</span>,&nbsp;<span class="string" style="color: #050;">".35em"</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">327:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">"text-anchor"</span>,&nbsp;<span class="string" style="color: #050;">"middle"</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">328:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text(<span class="keyword" style="font-weight: bold; color: navy;">function</span>(d,i)&nbsp;{&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;i+<span class="number" style="color: #800;">1</span>;&nbsp;});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">329:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">330:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Remove&nbsp;center&nbsp;text&nbsp;on&nbsp;chart&nbsp;update.&nbsp;TODO:&nbsp;Better&nbsp;way??</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">331:</span>&nbsp;&nbsp;&nbsp;&nbsp;_selection.selectAll(<span class="string" style="color: #050;">'.centerText'</span>).remove();<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">332:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">333:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Add&nbsp;the&nbsp;center&nbsp;text&nbsp;for&nbsp;the&nbsp;chart.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">334:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;centerText&nbsp;=&nbsp;_selection.append(<span class="string" style="color: #050;">'text'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">335:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'text-anchor'</span>,&nbsp;<span class="string" style="color: #050;">'middle'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">336:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.text(<span class="string" style="color: #050;">'Mouse&nbsp;over&nbsp;a&nbsp;segment&nbsp;to&nbsp;see&nbsp;the&nbsp;total.'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">337:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'class'</span>,&nbsp;<span class="string" style="color: #050;">'centerText'</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">338:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">339:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//On&nbsp;mouseover&nbsp;function&nbsp;to&nbsp;display&nbsp;segment&nbsp;total.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">340:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="func-title">mouseover</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">341:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;centerText.text(<span class="string" style="color: #050;">'Total:&nbsp;'</span>&nbsp;+&nbsp;d.value);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">342:</span>&nbsp;&nbsp;&nbsp;&nbsp;}<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">343:</span>&nbsp;&nbsp;}<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">344:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">345:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Method&nbsp;to&nbsp;get/set&nbsp;the&nbsp;inner&nbsp;radius.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">346:</span>&nbsp;&nbsp;chart.innerRadius&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(_innerRadius)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">347:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">if</span>(!arguments.length)&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;innerRadius;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">348:</span>&nbsp;&nbsp;&nbsp;&nbsp;innerRadius&nbsp;=&nbsp;_innerRadius;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">349:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;chart;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">350:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">351:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">352:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Method&nbsp;to&nbsp;get/set&nbsp;the&nbsp;outer&nbsp;radius.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">353:</span>&nbsp;&nbsp;chart.outerRadius&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(_outerRadius)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">354:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">if</span>(!arguments.length)&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;outerRadius;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">355:</span>&nbsp;&nbsp;&nbsp;&nbsp;outerRadius&nbsp;=&nbsp;_outerRadius;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">356:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;chart;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">357:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">358:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">359:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Method&nbsp;to&nbsp;get/set&nbsp;the&nbsp;crossfilter&nbsp;group.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">360:</span>&nbsp;&nbsp;chart.group&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(_group)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">361:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">if</span>(!arguments.length)&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;group;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">362:</span>&nbsp;&nbsp;&nbsp;&nbsp;group&nbsp;=&nbsp;_group;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">363:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;chart;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">364:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">365:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">366:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Method&nbsp;to&nbsp;get/set&nbsp;the&nbsp;label&nbsp;offset.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">367:</span>&nbsp;&nbsp;chart.offset&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(_offset)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">368:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">if</span>(!arguments.length)&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;offset;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">369:</span>&nbsp;&nbsp;&nbsp;&nbsp;offset&nbsp;=&nbsp;_offset;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">370:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;chart;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">371:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">372:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">373:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Method&nbsp;to&nbsp;get/set&nbsp;the&nbsp;crossfilter&nbsp;dimension.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">374:</span>&nbsp;&nbsp;chart.dimension&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(_dimension)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">375:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">if</span>(!arguments.length)&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;dimension;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">376:</span>&nbsp;&nbsp;&nbsp;&nbsp;dimension&nbsp;=&nbsp;_dimension;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">377:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;chart;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">378:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">379:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">380:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Method&nbsp;to&nbsp;get/set&nbsp;the&nbsp;color&nbsp;range.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">381:</span>&nbsp;&nbsp;chart.colorRange&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(_array)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">382:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">if</span>(!arguments.length)&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;[lowerColor,&nbsp;upperColor];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">383:</span>&nbsp;&nbsp;&nbsp;&nbsp;lowerColor&nbsp;=&nbsp;_array[<span class="number" style="color: #800;">0</span>];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">384:</span>&nbsp;&nbsp;&nbsp;&nbsp;upperColor&nbsp;=&nbsp;_array[<span class="number" style="color: #800;">1</span>];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">385:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;chart;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">386:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">387:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">388:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Method&nbsp;to&nbsp;get/set&nbsp;the&nbsp;radial&nbsp;range/</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">389:</span>&nbsp;&nbsp;chart.radialRange&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(_array)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">390:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">if</span>(!arguments.length)&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;[innerRange,&nbsp;outerRange];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">391:</span>&nbsp;&nbsp;&nbsp;&nbsp;innerRange&nbsp;=&nbsp;_array[<span class="number" style="color: #800;">0</span>];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">392:</span>&nbsp;&nbsp;&nbsp;&nbsp;outerRange&nbsp;=&nbsp;_array[<span class="number" style="color: #800;">1</span>];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">393:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;chart;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">394:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">395:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">396:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Finally,&nbsp;return&nbsp;the&nbsp;chart.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">397:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;chart;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">398:</span>};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">399:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">400:</span><span class="comment" style="color: #777;">//Define&nbsp;our&nbsp;width&nbsp;and&nbsp;height&nbsp;for&nbsp;our&nbsp;visualizations.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">401:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;width&nbsp;=&nbsp;<span class="number" style="color: #800;">570</span>,<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">402:</span>&nbsp;&nbsp;&nbsp;&nbsp;height&nbsp;=&nbsp;<span class="number" style="color: #800;">500</span>;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">403:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">404:</span><span class="comment" style="color: #777;">//Instantiate&nbsp;our&nbsp;data&nbsp;manager&nbsp;module&nbsp;for&nbsp;each&nbsp;city.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">405:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;sanFranciscoDataManager&nbsp;=&nbsp;d3Edge.dataManager(),<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">406:</span>&nbsp;&nbsp;&nbsp;&nbsp;zurichDataManager&nbsp;=&nbsp;d3Edge.dataManager(),<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">407:</span>&nbsp;&nbsp;&nbsp;&nbsp;genevaDataManager&nbsp;=&nbsp;d3Edge.dataManager();<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">408:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">409:</span><span class="comment" style="color: #777;">//Instantiate&nbsp;our&nbsp;radial&nbsp;module&nbsp;for&nbsp;each&nbsp;city.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">410:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;zurichRadial&nbsp;=&nbsp;d3Edge.radialHistogram().colorRange([<span class="string" style="color: #050;">'lightblue'</span>,&nbsp;<span class="string" style="color: #050;">'darkblue'</span>])<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">411:</span>&nbsp;&nbsp;.innerRadius(<span class="number" style="color: #800;">5</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">412:</span>&nbsp;&nbsp;.outerRadius(<span class="number" style="color: #800;">200</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">413:</span>&nbsp;&nbsp;.offset(<span class="number" style="color: #800;">15</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">414:</span>&nbsp;&nbsp;.radialRange([<span class="number" style="color: #800;">100</span>,<span class="number" style="color: #800;">200</span>]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">415:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">416:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;genevaRadial&nbsp;=&nbsp;d3Edge.radialHistogram().colorRange([<span class="string" style="color: #050;">'lightblue'</span>,&nbsp;<span class="string" style="color: #050;">'darkblue'</span>])<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">417:</span>&nbsp;&nbsp;.innerRadius(<span class="number" style="color: #800;">5</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">418:</span>&nbsp;&nbsp;.outerRadius(<span class="number" style="color: #800;">200</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">419:</span>&nbsp;&nbsp;.offset(<span class="number" style="color: #800;">15</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">420:</span>&nbsp;&nbsp;.radialRange([<span class="number" style="color: #800;">100</span>,<span class="number" style="color: #800;">200</span>]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">421:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">422:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;sanFranRadial&nbsp;=&nbsp;d3Edge.radialHistogram().colorRange([<span class="string" style="color: #050;">'lightblue'</span>,&nbsp;<span class="string" style="color: #050;">'darkblue'</span>])<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">423:</span>&nbsp;&nbsp;.innerRadius(<span class="number" style="color: #800;">5</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">424:</span>&nbsp;&nbsp;.outerRadius(<span class="number" style="color: #800;">200</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">425:</span>&nbsp;&nbsp;.offset(<span class="number" style="color: #800;">15</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">426:</span>&nbsp;&nbsp;.radialRange([<span class="number" style="color: #800;">100</span>,<span class="number" style="color: #800;">200</span>]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">427:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">428:</span><span class="comment" style="color: #777;">//Instantiate&nbsp;our&nbsp;map&nbsp;module&nbsp;for&nbsp;Zurich.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">429:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;zurichMap&nbsp;=&nbsp;d3Edge.map()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">430:</span>&nbsp;&nbsp;.center([<span class="number" style="color: #800;">8.5390</span>,&nbsp;<span class="number" style="color: #800;">47.3687</span>])<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">431:</span>&nbsp;&nbsp;.scale(<span class="number" style="color: #800;">900000</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">432:</span>&nbsp;&nbsp;.size([width,&nbsp;height]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">433:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">434:</span><span class="comment" style="color: #777;">//Instantiate&nbsp;our&nbsp;map&nbsp;module&nbsp;for&nbsp;Geneva.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">435:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;genevaMap&nbsp;=&nbsp;d3Edge.map()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">436:</span>&nbsp;&nbsp;.center([<span class="number" style="color: #800;">6.14</span>,&nbsp;<span class="number" style="color: #800;">46.24</span>])<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">437:</span>&nbsp;&nbsp;.scale(<span class="number" style="color: #800;">400000</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">438:</span>&nbsp;&nbsp;.size([width,&nbsp;height]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">439:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">440:</span><span class="comment" style="color: #777;">//Instantiate&nbsp;our&nbsp;map&nbsp;module&nbsp;for&nbsp;San&nbsp;Francisco.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">441:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;sanFranciscoMap&nbsp;=&nbsp;d3Edge.map()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">442:</span>&nbsp;&nbsp;.center([-<span class="number" style="color: #800;">122.4376</span>,&nbsp;<span class="number" style="color: #800;">37.77</span>])<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">443:</span>&nbsp;&nbsp;.scale(<span class="number" style="color: #800;">900000</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">444:</span>&nbsp;&nbsp;.size([width,&nbsp;height]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">445:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">446:</span><span class="comment" style="color: #777;">//Bind&nbsp;our&nbsp;modules&nbsp;to&nbsp;the&nbsp;DOM.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">447:</span>d3.select(<span class="string" style="color: #050;">'#zurich_map'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">448:</span>&nbsp;&nbsp;.append(<span class="string" style="color: #050;">'svg'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">449:</span>&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'width'</span>,&nbsp;width)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">450:</span>&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'height'</span>,&nbsp;height)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">451:</span>&nbsp;&nbsp;&nbsp;&nbsp;.call(zurichMap);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">452:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">453:</span>d3.select(<span class="string" style="color: #050;">'#geneva_map'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">454:</span>&nbsp;&nbsp;.append(<span class="string" style="color: #050;">'svg'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">455:</span>&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'width'</span>,&nbsp;width)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">456:</span>&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'height'</span>,&nbsp;height)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">457:</span>&nbsp;&nbsp;&nbsp;&nbsp;.call(genevaMap);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">458:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">459:</span>d3.select(<span class="string" style="color: #050;">'#san_francisco_map'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">460:</span>&nbsp;&nbsp;.append(<span class="string" style="color: #050;">'svg'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">461:</span>&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'width'</span>,&nbsp;width)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">462:</span>&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'height'</span>,&nbsp;height)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">463:</span>&nbsp;&nbsp;&nbsp;&nbsp;.call(sanFranciscoMap);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">464:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">465:</span><span class="comment" style="color: #777;">//Set&nbsp;up&nbsp;the&nbsp;DOM&nbsp;for&nbsp;each&nbsp;city&nbsp;for&nbsp;the&nbsp;radial&nbsp;chart.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">466:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;zurichHist&nbsp;=&nbsp;d3.select(<span class="string" style="color: #050;">'#zurich_hist'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">467:</span>&nbsp;&nbsp;.append(<span class="string" style="color: #050;">'svg'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">468:</span>&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'width'</span>,&nbsp;width)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">469:</span>&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'height'</span>,&nbsp;height)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">470:</span>&nbsp;&nbsp;.append(<span class="string" style="color: #050;">'g'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">471:</span>&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'transform'</span>,&nbsp;<span class="string" style="color: #050;">'translate('</span>&nbsp;+&nbsp;width/<span class="number" style="color: #800;">2</span>&nbsp;+&nbsp;<span class="string" style="color: #050;">','</span>&nbsp;+&nbsp;height/<span class="number" style="color: #800;">2</span>&nbsp;+&nbsp;<span class="string" style="color: #050;">')'</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">472:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">473:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;genevaHist&nbsp;=&nbsp;d3.select(<span class="string" style="color: #050;">'#geneva_hist'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">474:</span>&nbsp;&nbsp;.append(<span class="string" style="color: #050;">'svg'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">475:</span>&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'width'</span>,&nbsp;width)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">476:</span>&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'height'</span>,&nbsp;height)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">477:</span>&nbsp;&nbsp;.append(<span class="string" style="color: #050;">'g'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">478:</span>&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'transform'</span>,&nbsp;<span class="string" style="color: #050;">'translate('</span>&nbsp;+&nbsp;width/<span class="number" style="color: #800;">2</span>&nbsp;+&nbsp;<span class="string" style="color: #050;">','</span>&nbsp;+&nbsp;height/<span class="number" style="color: #800;">2</span>&nbsp;+&nbsp;<span class="string" style="color: #050;">')'</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">479:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">480:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;sanFranHist&nbsp;=&nbsp;d3.select(<span class="string" style="color: #050;">'#sanFran_hist'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">481:</span>&nbsp;&nbsp;.append(<span class="string" style="color: #050;">'svg'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">482:</span>&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'width'</span>,&nbsp;width)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">483:</span>&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'height'</span>,&nbsp;height)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">484:</span>&nbsp;&nbsp;.append(<span class="string" style="color: #050;">'g'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">485:</span>&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'transform'</span>,&nbsp;<span class="string" style="color: #050;">'translate('</span>&nbsp;+&nbsp;width/<span class="number" style="color: #800;">2</span>&nbsp;+&nbsp;<span class="string" style="color: #050;">','</span>&nbsp;+&nbsp;height/<span class="number" style="color: #800;">2</span>&nbsp;+&nbsp;<span class="string" style="color: #050;">')'</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">486:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">487:</span><span class="comment" style="color: #777;">//Load&nbsp;the&nbsp;routes&nbsp;data&nbsp;and&nbsp;pass&nbsp;our&nbsp;drawRoutes&nbsp;method&nbsp;as&nbsp;the&nbsp;callback&nbsp;to&nbsp;be&nbsp;executed&nbsp;once&nbsp;the&nbsp;data&nbsp;loads.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">488:</span>zurichDataManager.loadGeoJson(<span class="string" style="color: #050;">'../../../data/zurich/routes_topo.json'</span>,&nbsp;zurichMap.drawRoutes);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">489:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">490:</span><span class="comment" style="color: #777;">//After&nbsp;the&nbsp;routes&nbsp;have&nbsp;been&nbsp;drawn,&nbsp;draw&nbsp;the&nbsp;stops.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">491:</span>zurichMap.on(<span class="string" style="color: #050;">'routesEnd'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">()</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">492:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Load&nbsp;the&nbsp;stops&nbsp;data&nbsp;and&nbsp;pass&nbsp;our&nbsp;drawStops&nbsp;method&nbsp;as&nbsp;the&nbsp;callback&nbsp;to&nbsp;be&nbsp;executed&nbsp;once&nbsp;the&nbsp;data&nbsp;loads.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">493:</span>&nbsp;&nbsp;zurichDataManager.loadGeoJson(<span class="string" style="color: #050;">'../../../data/zurich/stops_geo.json'</span>,&nbsp;zurichMap.drawStops);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">494:</span>});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">495:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">496:</span><span class="comment" style="color: #777;">//Load&nbsp;the&nbsp;routes&nbsp;data&nbsp;and&nbsp;pass&nbsp;our&nbsp;drawRoutes&nbsp;method&nbsp;as&nbsp;the&nbsp;callback&nbsp;to&nbsp;be&nbsp;executed&nbsp;once&nbsp;the&nbsp;data&nbsp;loads.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">497:</span>genevaDataManager.loadGeoJson(<span class="string" style="color: #050;">'../../../data/geneva/routes_topo.json'</span>,&nbsp;genevaMap.drawRoutes);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">498:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">499:</span><span class="comment" style="color: #777;">//After&nbsp;the&nbsp;routes&nbsp;have&nbsp;been&nbsp;drawn,&nbsp;draw&nbsp;the&nbsp;stops.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">500:</span>genevaMap.on(<span class="string" style="color: #050;">'routesEnd'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">()</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">501:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Load&nbsp;the&nbsp;stops&nbsp;data&nbsp;and&nbsp;pass&nbsp;our&nbsp;drawStops&nbsp;method&nbsp;as&nbsp;the&nbsp;callback&nbsp;to&nbsp;be&nbsp;executed&nbsp;once&nbsp;the&nbsp;data&nbsp;loads.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">502:</span>&nbsp;&nbsp;genevaDataManager.loadGeoJson(<span class="string" style="color: #050;">'../../../data/geneva/stops_geo.json'</span>,&nbsp;genevaMap.drawStops);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">503:</span>});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">504:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">505:</span><span class="comment" style="color: #777;">//Load&nbsp;the&nbsp;routes&nbsp;data&nbsp;and&nbsp;pass&nbsp;our&nbsp;drawRoutes&nbsp;method&nbsp;as&nbsp;the&nbsp;callback&nbsp;to&nbsp;be&nbsp;executed&nbsp;once&nbsp;the&nbsp;data&nbsp;loads.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">506:</span>sanFranciscoDataManager.loadGeoJson(<span class="string" style="color: #050;">'../../../data/san_francisco/routes_topo.json'</span>,&nbsp;sanFranciscoMap.drawRoutes);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">507:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">508:</span><span class="comment" style="color: #777;">//After&nbsp;the&nbsp;routes&nbsp;have&nbsp;been&nbsp;drawn,&nbsp;draw&nbsp;the&nbsp;stops.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">509:</span>sanFranciscoMap.on(<span class="string" style="color: #050;">'routesEnd'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">()</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">510:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Load&nbsp;the&nbsp;stops&nbsp;data&nbsp;and&nbsp;pass&nbsp;our&nbsp;drawStops&nbsp;method&nbsp;as&nbsp;the&nbsp;callback&nbsp;to&nbsp;be&nbsp;executed&nbsp;once&nbsp;the&nbsp;data&nbsp;loads.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">511:</span>&nbsp;&nbsp;sanFranciscoDataManager.loadGeoJson(<span class="string" style="color: #050;">'../../../data/san_francisco/stops_geo.json'</span>,&nbsp;sanFranciscoMap.drawStops);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">512:</span>});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">513:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">514:</span><span class="comment" style="color: #777;">//Load&nbsp;our&nbsp;Zurich&nbsp;data,&nbsp;and&nbsp;supply&nbsp;the&nbsp;cleaning&nbsp;function.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">515:</span>zurichDataManager.loadCsvData(<span class="string" style="color: #050;">'../../../data/zurich/zurich_delay.csv'</span>,&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(d){<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">516:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;timeFormat&nbsp;=&nbsp;d3.time.format(<span class="string" style="color: #050;">'%Y-%m-%d&nbsp;%H:%M:%S&nbsp;%p'</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">517:</span>&nbsp;&nbsp;d.DELAY&nbsp;=&nbsp;+d.DELAY_MIN;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">518:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">delete</span>&nbsp;d.DELAY_MIN;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">519:</span>&nbsp;&nbsp;d.SCHEDULED&nbsp;=&nbsp;timeFormat.parse(d.SCHEDULED);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">520:</span>&nbsp;&nbsp;d.LATITUDE&nbsp;=&nbsp;+d.LATITUDE;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">521:</span>&nbsp;&nbsp;d.LONGITUDE&nbsp;=&nbsp;+d.LONGITUDE;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">522:</span>&nbsp;&nbsp;d.LOCATION&nbsp;=&nbsp;[d.LONGITUDE,&nbsp;d.LATITUDE];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">523:</span>});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">524:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">525:</span><span class="comment" style="color: #777;">//Add&nbsp;our&nbsp;brush&nbsp;to&nbsp;the&nbsp;map.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">526:</span>zurichMap.addBrush();<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">527:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">528:</span><span class="comment" style="color: #777;">//On&nbsp;map&nbsp;brushing,&nbsp;filter&nbsp;the&nbsp;stop&nbsp;metric&nbsp;data,&nbsp;pass&nbsp;filtered&nbsp;data&nbsp;into&nbsp;radial&nbsp;chart.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">529:</span>zurichMap.on(<span class="string" style="color: #050;">'brushing'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(brush)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">530:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Get&nbsp;the&nbsp;locations&nbsp;inside&nbsp;the&nbsp;brush.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">531:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;filteredLocations&nbsp;=&nbsp;zurichDataManager.filterLocation(brush.extent()),<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">532:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Get&nbsp;the&nbsp;delays&nbsp;inside&nbsp;the&nbsp;area.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">533:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delaysByHourAndLocation&nbsp;=&nbsp;zurichDataManager.getDelays(filteredLocations);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">534:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">535:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Pass&nbsp;in&nbsp;our&nbsp;filtered&nbsp;delays&nbsp;to&nbsp;the&nbsp;radial&nbsp;histogram.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">536:</span>&nbsp;&nbsp;zurichRadial.group(delaysByHourAndLocation[<span class="number" style="color: #800;">1</span>]).dimension(delaysByHourAndLocation[<span class="number" style="color: #800;">0</span>]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">537:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Update&nbsp;radial&nbsp;chart&nbsp;with&nbsp;the&nbsp;new&nbsp;data.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">538:</span>&nbsp;&nbsp;zurichHist.call(zurichRadial);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">539:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">540:</span>});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">541:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">542:</span><span class="comment" style="color: #777;">//Load&nbsp;our&nbsp;Geneva&nbsp;data,&nbsp;and&nbsp;supply&nbsp;the&nbsp;cleaning&nbsp;function.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">543:</span>genevaDataManager.loadCsvData(<span class="string" style="color: #050;">'../../../data/geneva/geneva_delay_coord.csv'</span>,&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(d){<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">544:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;timeFormat&nbsp;=&nbsp;d3.time.format(<span class="string" style="color: #050;">'%Y-%m-%d&nbsp;%H:%M:%S&nbsp;%p'</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">545:</span>&nbsp;&nbsp;d.DELAY&nbsp;=&nbsp;+d.DELAY;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">546:</span>&nbsp;&nbsp;d.SCHEDULED&nbsp;=&nbsp;timeFormat.parse(d.SCHEDULED);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">547:</span>&nbsp;&nbsp;d.LATITUDE&nbsp;=&nbsp;+d.LATITUDE;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">548:</span>&nbsp;&nbsp;d.LONGITUDE&nbsp;=&nbsp;+d.LONGITUDE;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">549:</span>&nbsp;&nbsp;d.LOCATION&nbsp;=&nbsp;[d.LONGITUDE,&nbsp;d.LATITUDE];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">550:</span>});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">551:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">552:</span><span class="comment" style="color: #777;">//Add&nbsp;our&nbsp;brush&nbsp;to&nbsp;the&nbsp;map.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">553:</span>genevaMap.addBrush();<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">554:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">555:</span><span class="comment" style="color: #777;">//On&nbsp;map&nbsp;brushing,&nbsp;filter&nbsp;the&nbsp;stop&nbsp;metric&nbsp;data,&nbsp;pass&nbsp;filtered&nbsp;data&nbsp;into&nbsp;radial&nbsp;chart.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">556:</span>genevaMap.on(<span class="string" style="color: #050;">'brushing'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(brush)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">557:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Get&nbsp;the&nbsp;locations&nbsp;inside&nbsp;the&nbsp;brush.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">558:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;filteredLocations&nbsp;=&nbsp;genevaDataManager.filterLocation(brush.extent()),<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">559:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Get&nbsp;the&nbsp;locations&nbsp;inside&nbsp;the&nbsp;brush.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">560:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delaysByHourAndLocation&nbsp;=&nbsp;genevaDataManager.getDelays(filteredLocations);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">561:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">562:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Pass&nbsp;in&nbsp;our&nbsp;filtered&nbsp;delays&nbsp;to&nbsp;the&nbsp;radial&nbsp;histogram.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">563:</span>&nbsp;&nbsp;genevaRadial.group(delaysByHourAndLocation[<span class="number" style="color: #800;">1</span>]).dimension(delaysByHourAndLocation[<span class="number" style="color: #800;">0</span>]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">564:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Update&nbsp;the&nbsp;radial&nbsp;chart&nbsp;with&nbsp;the&nbsp;new&nbsp;data.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">565:</span>&nbsp;&nbsp;genevaHist.call(genevaRadial);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">566:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">567:</span>});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">568:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">569:</span><span class="comment" style="color: #777;">//Load&nbsp;our&nbsp;San&nbsp;Francisco&nbsp;data,&nbsp;and&nbsp;supply&nbsp;the&nbsp;cleaning&nbsp;function.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">570:</span>sanFranciscoDataManager.loadCsvData(<span class="string" style="color: #050;">'../../../data/san_francisco/san_francisco_delay.csv'</span>,&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(d){<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">571:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;timeFormat&nbsp;=&nbsp;d3.time.format(<span class="string" style="color: #050;">'%Y-%m-%d&nbsp;%H:%M:%S&nbsp;%p'</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">572:</span>&nbsp;&nbsp;d.DELAY&nbsp;=&nbsp;+d.DELAY_MIN;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">573:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">delete</span>&nbsp;d.DELAY_MIN;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">574:</span>&nbsp;&nbsp;d.SCHEDULED&nbsp;=&nbsp;timeFormat.parse(d.SCHEDULED);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">575:</span>&nbsp;&nbsp;d.LATITUDE&nbsp;=&nbsp;+d.LATITUDE;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">576:</span>&nbsp;&nbsp;d.LONGITUDE&nbsp;=&nbsp;+d.LONGITUDE;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">577:</span>&nbsp;&nbsp;d.LOCATION&nbsp;=&nbsp;[d.LONGITUDE,&nbsp;d.LATITUDE];<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">578:</span>});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">579:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">580:</span><span class="comment" style="color: #777;">//Add&nbsp;our&nbsp;brush&nbsp;to&nbsp;the&nbsp;map.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">581:</span>sanFranciscoMap.addBrush();<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">582:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">583:</span><span class="comment" style="color: #777;">//On&nbsp;map&nbsp;brushing,&nbsp;filter&nbsp;the&nbsp;stop&nbsp;metric&nbsp;data,&nbsp;pass&nbsp;filtered&nbsp;data&nbsp;into&nbsp;radial&nbsp;chart.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">584:</span>sanFranciscoMap.on(<span class="string" style="color: #050;">'brushing'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(brush)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">585:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Get&nbsp;the&nbsp;locations&nbsp;inside&nbsp;the&nbsp;brush.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">586:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;filteredLocations&nbsp;=&nbsp;sanFranciscoDataManager.filterLocation(brush.extent()),<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">587:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Get&nbsp;the&nbsp;locations&nbsp;inside&nbsp;the&nbsp;brush.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">588:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delaysByHourAndLocation&nbsp;=&nbsp;sanFranciscoDataManager.getDelays(filteredLocations);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">589:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">590:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Pass&nbsp;in&nbsp;our&nbsp;filtered&nbsp;delays&nbsp;to&nbsp;the&nbsp;radial&nbsp;histogram.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">591:</span>&nbsp;&nbsp;sanFranRadial.group(delaysByHourAndLocation[<span class="number" style="color: #800;">1</span>]).dimension(delaysByHourAndLocation[<span class="number" style="color: #800;">0</span>]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">592:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Update&nbsp;the&nbsp;radial&nbsp;chart&nbsp;with&nbsp;the&nbsp;new&nbsp;data.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">593:</span>&nbsp;&nbsp;sanFranHist.call(sanFranRadial);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">594:</span>});</code></pre>
